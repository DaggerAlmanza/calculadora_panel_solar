<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeAppliance</title>
</head>
<body>
    <div>
        <div class="row" id="divCalculator">
            Agregar eletrodomestico: <input type="button" onclick="addElement()" value="+">
        </div>
        <input type="submit" onclick="endElement()" value="Calcular" action="http://127.0.0.1:5000/electrodomesticos" method="POST">
        
    </div>
</body>
<script>
    var id = 0

    function addElement() {

        id = id + 1

        // Establecemos nuestro div padre
        var currentDiv = document.getElementById("divCalculator");

        // creamos nuestros elementos
        var homeApplianceInput = document.createElement("input");
        var consumptionInput = document.createElement("input");
        var quantityInput = document.createElement("input");
        var categorySelect = document.createElement("select");
        var timeInput = document.createElement("input");
        

        // Establecemos el tipo
        homeApplianceInput.type = "text"
        consumptionInput.type = "number"
        quantityInput.type = "number"
        timeInput.type = "number"


        // Establecemos el nombre
        homeApplianceInput.id = "homeAppliance_"+id
        consumptionInput.id = "consumption_"+id
        quantityInput.id = "quantity_"+id
        categorySelect.id = "category_"+id
        timeInput.id = "time_"+id


        // Establecemos los valores del select
        categoryList = {
            "A": 0.95,
            "B": 0.90,
            "C": 0.85,
            "D": 0.80,
            "E": 0.75,
            "F": 0.70
        }

            for (const category in categoryList) {
                var categoryOption = document.createElement("option");
                categoryOption.text = category;
                categoryOption.value = categoryList[category];
                categorySelect.add(categoryOption);
            }

        // Se lo anexamos al contenedor
        currentDiv.appendChild(homeApplianceInput);
        currentDiv.appendChild(consumptionInput);
        currentDiv.appendChild(quantityInput);
        currentDiv.appendChild(categorySelect);
        currentDiv.appendChild(timeInput);

        // a√±ade el elemento creado y su contenido al DOM
        
    } 
        
    function endElement(jsonEnvio) {
        var jsonEnvio = []
        for (var i = 1; i <= id; i++) {
            
            jsonEnvio.push({
                "consumption": document.getElementById("consumption_"+i).value,
                "consumptions_hour": document.getElementById("time_"+i).value,
                "power_factor_type": document.getElementById("category_"+i).value,
                "qty": document.getElementById("quantity_"+i).value
            });
            } 
            
        console.log(jsonEnvio)
        return({
                "homeAppliances": jsonEnvio
                })


        }

    
</script>
</html>